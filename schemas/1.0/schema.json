{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://openwinspec.org/orderschema.json",
  "title": "Order",
  "description": "Order in Windows Branch",
  "type": "object",
  "properties": {
    "openwinversion": {
      "type": "string"
    },
    "info": {
      "$ref": "#/definitions/Info"
    },
    "definitions": {
      "type": "object",
      "description": "--- ранее order_data",
      "properties": {
        "data": {
          "type": "string",
          "description": "Дата заказа"
        },
        "customer": {
          "type": "string",
          "description": "Заказчик"
        },
        "specification": {
          "type": "string",
          "description": "--- Зачем ?"
        }
      }
    },
    "dictionaries": {
      "$ref": "#/definitions/Dictionaries"
    },
    "constructions": {
      "type": "array",
      "description": "--- Альтернативно items, apertures, component, RoughOpening, определить что первично, конструкция или проем",
      "items": {
        "$ref": "#/definitions/Construction"
      }
    }
  },
  "required": [
    "info",
    "openwinversion"
  ],
  "definitions": {
    "ID": {
      "type": "object",
      "properties": {
        "value": {
          "type": "string"
        },
        "prefix": {
          "type": "string"
        }
      },
      "additionalProperties": false,
      "required": [
        "value"
      ]
    },
    "Info": {
      "type": "object",
      "properties": {
        "id": {
          "description": "Ункальный ID заказа",
          "type": "string"
        },
        "locale": {
          "type": "string"
        }
      },
      "additionalProperties": false,
      "required": [
        "id"
      ]
    },
    "Point": {
      "type": "object",
      "description": "--- Описание геометрической точки 3D, если координата отсутствует то она равно 0, поэтому убрали required",
      "properties": {
        "id": {
          "$ref": "#/definitions/ID"
        },
        "x": {
          "type": "number"
        },
        "y": {
          "type": "number"
        },
        "z": {
          "type": "number"
        }
      },
      "additionalProperties": false
    },
    "Segment": {
      "type": "object",
      "description": "Описание геометрического отрезка 3D для проволочной модели",
      "properties": {
        "id": {
          "$ref": "#/definitions/ID"
        },
        "start": {
          "$ref": "#/definitions/Point"
        },
        "end": {
          "$ref": "#/definitions/Point"
        },
        "arcHeight": {
          "type": "number"
        }
      },
      "additionalProperties": false,
      "required": [
        "start",
        "end"
      ]
    },
    "Polygon": {
      "type": "object",
      "description": "Полигон в 3D",
      "properties": {
        "id": {
          "$ref": "#/definitions/ID"
        },
        "sides": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/Segment"
          }
        },
        "closed": {
          "description": "замкнут ли периметр",
          "type": "boolean"
        }
      },
      "additionalProperties": false,
      "required": [
        "sides"
      ]
    },
    "Locale": {
      "description": "-- Один из вариантов реализации локализации",
      "type": "string",
      "enum": [
        "EN",
        "RU",
        "DE"
      ]
    },
    "LocaleString": {
      "type": "object",
      "properties": {
        "en": {
          "type": "string"
        },
        "ru": {
          "type": "string"
        },
        "de": {
          "type": "string"
        }
      },
      "anyOf": [
        {
          "required": [
            "en"
          ]
        },
        {
          "required": [
            "ru"
          ]
        },
        {
          "required": [
            "de"
          ]
        }
      ]
    },
    "Dictionaries": {
      "type": "object",
      "properties": {
        "sync": {
          "type": "boolean"
        },
        "vendors": {
          "type": "array",
          "description": "-- uniqueItems keyword exist in 2019-09 json schema, instead use unique",
          "unique": [
            "id"
          ],
          "items": {
            "$ref": "#/definitions/Vendor"
          }
        },
        "profileSystems": {
          "type": "array",
          "unique": [
            "id"
          ],
          "items": {
            "$ref": "#/definitions/ProfileSystem"
          }
        },
        "profiles": {
          "type": "array",
          "unique": [
            "id"
          ],
          "items": {
            "$ref": "#/definitions/Profile"
          }
        },
        "spacer": {
          "type": "array",
          "unique": [
            "id"
          ],
          "items": {
            "$ref": "#/definitions/Spacer"
          }
        },
        "glasses": {
          "type": "array",
          "unique": [
            "id"
          ],
          "items": {
            "$ref": "#/definitions/Glass"
          }
        },
        "glazing": {
          "type": "array",
          "unique": [
            "id"
          ],
          "items": {
            "$ref": "#/definitions/Glazing"
          }
        },
        "panels": {
          "type": "array",
          "unique": [
            "id"
          ],
          "items": {
            "$ref": "#/definitions/Panel"
          }
        },
        "colors": {
          "type": "array",
          "unique": [
            "id"
          ],
          "items": {
            "$ref": "#/definitions/Color"
          }
        }
      },
      "additionalProperties": false
    },
    "VendorType": {
      "type": "string",
      "enum": [
        "Profile",
        "Hardware",
        "Metall",
        "Glass",
        "Spacer",
        "Glazing",
        "Panel"
      ]
    },
    "Vendor": {
      "type": "object",
      "properties": {
        "id": {
          "$ref": "#/definitions/ID"
        },
        "vendorType": {
          "$ref": "#/definitions/VendorType"
        },
        "name": {
          "$ref": "#/definitions/LocaleString"
        },
        "web": {
          "type": "string"
        }
      },
      "additionalProperties": false,
      "required": [
        "id",
        "vendorType",
        "name"
      ]
    },
    "VendorMaterial": {
      "type": "object",
      "properties": {
        "vendor": {
          "$ref": "#/definitions/ID",
          "dictionary": {
            "path": "dictionaries/vendors",
            "key": "id"
          }
        },
        "article": {
          "description": "Артикул в учетных системах поставщика",
          "type": "string"
        },
        "name": {
          "description": "Название в учетных системах поставщика",
          "type": "string"
        }
      },
      "additionalProperties": false,
      "required": [
        "vendor",
        "article",
        "name"
      ]
    },
    "ProfileType": {
      "type": "string",
      "description": "--- Как описать типы на разных языках ???",
      "enum": [
        "Frame",
        "Sliding Frame",
        "Sash",
        "Mullion",
        "GlazingBead",
        "Reinforcement",
        "PseudoMullion",
        "Coupling",
        "Extension"
      ]
    },
    "ProfileSystem": {
      "type": "object",
      "properties": {
        "id": {
          "$ref": "#/definitions/ID"
        },
        "vendor": {
          "$ref": "#/definitions/ID",
          "dictionary": {
            "path": "/dictionaries/vendors",
            "key": "id"
          }
        },
        "name": {
          "type": "string"
        }
      },
      "additionalProperties": false,
      "required": [
        "id",
        "vendor",
        "name"
      ]
    },
    "Profile": {
      "type": "object",
      "description": "--- Описываем армирование здесь?",
      "properties": {
        "id": {
          "$ref": "#/definitions/ID"
        },
        "vendorArticle": {
          "$ref": "#/definitions/VendorMaterial"
        },
        "profileType": {
          "$ref": "#/definitions/ProfileType"
        },
        "profileSystem": {
          "$ref": "#/definitions/ID",
          "dictionary": {
            "path": "/dictionaries/profileSystems",
            "key": "id"
          }
        },
        "a": {
          "type": "number"
        },
        "b": {
          "type": "number"
        },
        "c": {
          "type": "number"
        },
        "d": {
          "type": "number"
        },
        "e": {
          "type": "number"
        },
        "w": {
          "type": "number"
        },
        "w1": {
          "type": "number"
        },
        "w2": {
          "type": "number"
        },
        "h": {
          "type": "number"
        },
        "h1": {
          "type": "number"
        },
        "n": {
          "description": "Количество направляющих для раздвижных коробок",
          "type": "number"
        },
        "baseColor": {
          "$ref": "#/definitions/ID"
        },
        "internalColor": {
          "$ref": "#/definitions/ID"
        },
        "externalColor": {
          "$ref": "#/definitions/ID"
        }
      },
      "additionalProperties": false,
      "required": [
        "id",
        "vendorArticle",
        "profileType"
      ]
    },
    "ColorType": {
      "description": "-- Тип кодирования цвета (классификатор)",
      "type": "string",
      "enum": [
        "PVC",
        "Renolit",
        "RAL"
      ]
    },
    "Color": {
      "type": "object",
      "properties": {
        "id": {
          "$ref": "#/definitions/ID"
        },
        "colorName": {
          "type": "string"
        },
        "colorCode": {
          "type": "string"
        },
        "colorType": {
          "$ref": "#/definitions/ColorType"
        }
      },
      "additionalProperties": false,
      "required": [
        "id",
        "colorName",
        "colorCode",
        "colorType"
      ]
    },
    "Panel": {
      "type": "object",
      "description": "-- Заполнения",
      "properties": {
        "id": {
          "$ref": "#/definitions/ID"
        },
        "vendorArticle": {
          "$ref": "#/definitions/VendorMaterial"
        },
        "panelType": {
          "description": "-- Вводим тип панели?",
          "type": "string"
        },
        "thickness": {
          "type": "number"
        },
        "weight": {
          "description": "-- Вес 1 м2",
          "type": "number"
        }
      },
      "additionalProperties": false,
      "required": [
        "id",
        "vendorArticle",
        "thickness"
      ]
    },
    "GlassType": {
      "type": "string",
      "description": "-- Тип стекла, ниже из классификации по https://www.doubleglazingnetwork.com/blog/window-glass-types/",
      "enum": [
        "Float Glass",
        "Laminated Safety Glass",
        "Obscured Glass",
        "Tinted Glass",
        "Tempered Glass",
        "Insulated Glass",
        "Mirrored Glass",
        "Low-E Glass",
        "Wired Glass"
      ]
    },
    "Glass": {
      "type": "object",
      "description": "-- Стекло, характеристики Lt-Ug см. например https://www.agc-yourglass.com/en-UK/brands/energy",
      "properties": {
        "id": {
          "$ref": "#/definitions/ID"
        },
        "vendorArticle": {
          "$ref": "#/definitions/VendorMaterial"
        },
        "glassType": {
          "$ref": "#/definitions/GlassType"
        },
        "thickness": {
          "type": "number"
        },
        "weight": {
          "description": "-- Вес 1 м2",
          "type": "number"
        },
        "Lt": {
          "type": "number"
        },
        "Sf": {
          "type": "number"
        },
        "Lr": {
          "type": "number"
        },
        "Ug": {
          "type": "number"
        }
      },
      "additionalProperties": false,
      "required": [
        "id",
        "vendorArticle",
        "glassType",
        "thickness"
      ]
    },
    "Glazing": {
      "type": "object",
      "properties": {
        "id": {
          "$ref": "#/definitions/ID"
        },
        "vendorArticle": {
          "$ref": "#/definitions/VendorMaterial"
        },
        "thickness": {
          "type": "number"
        },
        "glasses": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/Glass"
          }
        },
        "spacer": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/Spacer"
          }
        }
      },
      "additionalProperties": false,
      "required": [
        "id",
        "vendorArticle",
        "thickness",
        "glasses"
      ]
    },
    "SpacerMaterial": {
      "type": "string",
      "description": "-- Материал дистанционной рамки, см. например https://www.glastory.net/insulating-glass-spacers-all-you-wanted-to-know/ и https://glazingmag.ru/distantsionnaya-ramka-dlya-steklopaketa-vidy-i-naznachenie/ и https://okna-blitz.ru/drugoe/distantsionnye-ramki-dlya-steklopaketov-razmery-i-vidy.html",
      "enum": [
        "Aluminum",
        "Warm edge",
        "Stainless steel warm edge",
        "Plastic-metal hybrid warm edge",
        "Flexible warm edge",
        "TPS"
      ]
    },
    "Spacer": {
      "type": "object",
      "description": "-- Дистанционная рамка",
      "properties": {
        "id": {
          "$ref": "#/definitions/ID"
        },
        "vendorArticle": {
          "$ref": "#/definitions/VendorMaterial"
        },
        "size": {
          "description": "-- Ширина рамки",
          "type": "number"
        },
        "material": {
          "$ref": "#/definitions/SpacerMaterial"
        },
        "thickness": {
          "description": "-- Толщина стенки",
          "type": "number"
        },
        "weight": {
          "description": "Вес 1 п.м.",
          "type": "number"
        }
      },
      "additionalProperties": false,
      "required": [
        "id",
        "vendorArticle",
        "size"
      ]
    },
    "HardwareType": {
      "type": "object",
      "description": "--- to be defined",
      "properties": {
        "id": {
          "$ref": "#/definitions/ID"
        },
        "name": {
          "typw": "string"
        }
      }
    },
    "HardwareSystem": {
      "type": "object",
      "description": "--- to be defined",
      "properties": {
        "id": {
          "$ref": "#/definitions/ID"
        },
        "name": {
          "type": "string"
        }
      }
    },
    "ProductType": {
      "type": "string",
      "description": "Тип окна, преобразовано в enum. Зачем ?",
      "enum": [
        "Window",
        "Door"
      ]
    },
    "ComponentType": {
      "type": "string",
      "enum": [
        "Frame",
        "Sash",
        "Mullion",
        "Filling"
      ]
    },
    "ComponentFeatures": {
      "type": "object",
      "properties": {
        "commonFeature": {
          "$ref": "#/definitions/CommonFeature"
        },
        "frameFeature": {
          "$ref": "#/definitions/FrameFeature"
        },
        "sashFeature": {
          "$ref": "#/definitions/SashFeature"
        },
        "mullionFeature": {
          "$ref": "#/definitions/MullionFeature"
        },
        "fillingFeature": {
          "$ref": "#/definitions/FillingFeature"
        }
      },
      "additionalProperties": false,
      "oneOf": [
        {
          "required": [
            "frameFeature"
          ]
        },
        {
          "required": [
            "sashFeature"
          ]
        },
        {
          "required": [
            "mullionFeature"
          ]
        },
        {
          "required": [
            "fillingFeature"
          ]
        }
      ]
    },
    "CommonFeature": {
      "type": "object",
      "properties": {
        "baseColor": {
          "type": "string",
          "description": "-- цвет основы (для ПВХ)"
        },
        "internalColor": {
          "type": "string",
          "description": "-- цвет ламинации/покраски изнутри/сверху"
        },
        "externalColor": {
          "type": "string",
          "description": "-- цвет ламинации/покраски извне"
        }
      },
      "additionalProperties": false
    },
    "FrameFeature": {
      "type": "object",
      "properties": {
        "sillStub": {
          "type": "boolean",
          "description": "Наличие подставочного профиля"
        },
        "rabbetStub": {
          "type": "boolean",
          "description": "Наличие заглушки паза под штапик (для ПВХ)"
        },
        "drained": {
          "type": "boolean",
          "description": "Наличие дренажа"
        },
        "compensationHole": {
          "type": "boolean",
          "description": "Наличие компенсационных отверстий"
        }
      },
      "additionalProperties": false,
      "required": [
        "sillStub",
        "drained"
      ]
    },
    "SashOpeningType": {
      "type": "string",
      "enum": [
        "Casement",
        "TiltBottom",
        "TiltTop",
        "TiltAndTurn",
        "FixedCasement"
      ]
    },
    "SashFeature": {
      "type": "object",
      "properties": {
        "openingType": {
          "$ref": "#/definitions/SashOpeningType"
        }
      },
      "additionalProperties": false,
      "required": [
        "openingType"
      ]
    },
    "MullionFeature": {
      "type": "object",
      "properties": {
        "calcWind": {
          "type": "boolean",
          "description": "-- Расчет ветровой нагрузки"
        }
      },
      "additionalProperties": false
    },
    "FillingType": {
      "type": "string",
      "enum": [
        "Glazing",
        "Panel",
        "Virtual"
      ]
    },
    "GlazingFeature": {
      "type": "object",
      "properties": {
        "id": {
          "$ref": "#/definitions/ID"
        },
        "glazing": {
          "$ref": "#/definitions/ID",
          "description": "Ссылка на id из справочника glazing",
          "dictionary": {
            "path": "/dictionaries/glazing",
            "key": "id"
          }
        }
      },
      "additionalProperties": false
    },
    "PanelFeature": {
      "type": "object",
      "properties": {
        "id": {
          "$ref": "#/definitions/ID"
        },
        "panel": {
          "$ref": "#/definitions/ID",
          "description": "Ссылка на id из справочника panels",
          "dictionary": {
            "path": "/dictionaries/panels",
            "key": "id"
          }
        }
      },
      "additionalProperties": false
    },
    "VirtualFeature": {
      "type": "object",
      "properties": {
        "id": {
          "$ref": "#/definitions/ID"
        }
      }
    },
    "FillingTypeFeatures": {
      "type": "object",
      "properties": {
        "glazingFeature": {
          "$ref": "#/definitions/GlazingFeature"
        },
        "panelFeature": {
          "$ref": "#/definitions/PanelFeature"
        },
        "virtualFeature": {
          "$ref": "#/definitions/VirtualFeature"
        }
      },
      "oneOf": [
        {
          "required": [
            "glazingFeature"
          ]
        },
        {
          "required": [
            "panelFeature"
          ]
        },
        {
          "required": [
            "virtualFeature"
          ]
        }
      ],
      "additionalProperties": false
    },
    "FillingFeature": {
      "type": "object",
      "properties": {
        "size": {
          "type": "number"
        },
        "fillingType": {
          "$ref": "#/definitions/FillingType"
        },
        "features": {
          "$ref": "#/definitions/FillingTypeFeatures"
        },
        "glazingBeads": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/Beam"
          }
        }
      },
      "additionalProperties": false
    },
    "GlazingBeadFeature": {
      "type": "object",
      "properties": {
        "size": {
          "type": "number"
        },
        "material": {
          "type": "array",
          "description": "todo - Изменить название поля",
          "items": {
            "$ref": "#/definitions/VendorMaterial"
          }
        }
      },
      "additionalProperties": false
    },
    "CuttingType": {
      "type": "string",
      "enum": [
        "Angle45",
        "Vertical",
        "Horizontal",
        "Square"
      ]
    },
    "BeamCuttings": {
      "type": "object",
      "properties": {
        "start_ext": {
          "$ref": "#/definitions/CuttingType"
        },
        "start_int": {
          "$ref": "#/definitions/CuttingType"
        },
        "end_ext": {
          "$ref": "#/definitions/CuttingType"
        },
        "end_int": {
          "$ref": "#/definitions/CuttingType"
        }
      },
      "additionalProperties": false
    },
    "Beam": {
      "type": "object",
      "description": "--- Балка профиля",
      "properties": {
        "profile": {
          "$ref": "#/definitions/ID",
          "dictionary": {
            "path": "/dictionaries/profiles",
            "key": "id"
          }
        },
        "cuttings": {
          "$ref": "#/definitions/BeamCuttings"
        },
        "drain": {
          "type": "string",
          "enum": [
            "NotAvailable",
            "Available",
            "Hidden"
          ],
          "description": "тип дренажирования на балке"
        },
        "compensationHole": {
          "type": "boolean",
          "description": "наличие компенсационных отверстий на балке"
        },
        "baseColorId": {
          "$ref": "#/definitions/ID",
          "description": "-- цвет основы (для ПВХ)"
        },
        "internalColorId": {
          "$ref": "#/definitions/ID",
          "description": "-- цвет ламинации/покраски изнутри/сверху"
        },
        "externalColorId": {
          "$ref": "#/definitions/ID",
          "description": "-- цвет ламинации/покраски снаружи"
        }
      },
      "additionalProperties": false
    },
    "Component": {
      "type": "object",
      "properties": {
        "componentType": {
          "description": "--- ex element_type",
          "$ref": "#/definitions/ComponentType"
        },
        "features": {
          "$ref": "#/definitions/ComponentFeatures"
        },
        "geometryId": {
          "description": "--- ex poligon_id",
          "$ref": "#/definitions/ID"
        },
        "splitterId": {
          "description": "--- ссылка на геометрию сплиттера, как это объединить с geometryId ?",
          "$ref": "#/definitions/ID"
        },
        "profile": {
          "$ref": "#/definitions/ID",
          "description": "--- если применяется для всех балок компонента",
          "dictionary": {
            "path": "/dictionaries/profiles",
            "key": "id"
          }
        },
        "beams": {
          "type": "array",
          "description": "--- ex profile_polygon",
          "items": {
            "$ref": "#/definitions/Beam"
          }
        },
        "components": {
          "type": "array",
          "description": "--- ex product_elements",
          "items": {
            "$ref": "#/definitions/Component"
          }
        }
      },
      "additionalProperties": false
    },
    "Splitter": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "fixed",
            "virtual"
          ]
        },
        "segment": {
          "$ref": "#/definitions/Segment"
        }
      },
      "additionalProperties": false
    },
    "Wire": {
      "type": "object",
      "properties": {
        "geometry": {
          "type": "array",
          "description": "Добавить признак виртуальности",
          "items": {
            "$ref": "#/definitions/Polygon"
          }
        },
        "splitters": {
          "type": "array",
          "description": "--- ex segments",
          "items": {
            "$ref": "#/definitions/Splitter"
          }
        }
      },
      "additionalProperties": false
    },
    "Element": {
      "type": "object",
      "description": "--- Элемент конструкции",
      "properties": {
        "id": {
          "$ref": "#/definitions/ID"
        },
        "elementType": {
          "description": "--- Тип элемента",
          "$ref": "#/definitions/ProductType"
        },
        "profileSystem": {
          "$ref": "#/definitions/ID",
          "dictionary": {
            "path": "/dictionaries/profileSystems",
            "key": "id"
          }
        },
        "wires": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/Wire"
          }
        },
        "components": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/Component"
          }
        }
      },
      "required": [
        "id",
        "wires",
        "components"
      ],
      "additionalProperties": false
    },
    "Coupling": {
      "type": "object",
      "description": "--- Описание сединителя элементов конструкции",
      "properties": {
        "id": {
          "$ref": "#/definitions/ID"
        },
        "geometry": {
          "$ref": "#/definitions/Segment"
        },
        "profile": {
          "description": "-- профильный узел !?",
          "$ref": "#/definitions/ID",
          "dictionary": {
            "path": "/dictionaries/profiles",
            "key": "id"
          }
        },
        "cutting": {
          "$ref": "#/definitions/BeamCuttings"
        }
      },
      "required": [
        "id",
        "geometry",
        "profile"
      ],
      "additionalProperties": false
    },
    "Extension": {
      "type": "object",
      "description": "---- Описание расширителей",
      "properties": {
        "id": {
          "$ref": "#/definitions/ID"
        },
        "geometry": {
          "$ref": "#/definitions/Polygon"
        },
        "profile": {
          "description": "-- профильный узел !?",
          "$ref": "#/definitions/ID",
          "dictionary": {
            "path": "/dictionaries/profiles",
            "key": "id"
          }
        },
        "cutting": {
          "$ref": "#/definitions/BeamCuttings"
        }
      },
      "required": [
        "id",
        "geometry",
        "profile"
      ],
      "additionalProperties": false
    },
    "Construction": {
      "type": "object",
      "description": "Конструкция в заказе",
      "properties": {
        "id": {
          "$ref": "#/definitions/ID"
        },
        "roughOpening": {
          "description": "--- Проем в заказе",
          "$ref": "#/definitions/Polygon"
        },
        "elements": {
          "description": "--- Список элементов (products, components etc.) в конструкции, ex products",
          "type": "array",
          "items": {
            "$ref": "#/definitions/Element"
          }
        },
        "couplings": {
          "description": "--- Список соединителей элементов конструкции",
          "type": "array",
          "items": {
            "$ref": "#/definitions/Coupling"
          }
        },
        "extensions": {
          "description": "--- Список расширителей рам элементов конструкции",
          "type": "array",
          "items": {
            "$ref": "#/definitions/Extension"
          }
        }
      },
      "required": [
        "id"
      ],
      "additionalProperties": false
    }
  }
}